{{ define "main" }}
  <article class="post">
    <header>
      <p class="post__series">{{ .Params.series }} {{ with .Params.chapter }}｜{{ . }}{{ end }}</p>
      <h1>{{ .Title }}</h1>
      <p class="post__meta">
        公開日: {{ .Date.Format "2006-01-02 15:04" }} / タグ:
        {{ if .Params.tags }}
          {{ range $index, $tag := .Params.tags }}
            {{ if $index }}, {{ end }}#{{ $tag }}
          {{ end }}
        {{ else }}
          #未設定
        {{ end }}
      </p>
    </header>

    {{ partial "affiliate_notice.html" . }}

    {{ with .Params.disclaimer }}
      <p><strong>{{ . }}</strong></p>
    {{ else }}
      <p><strong>{{ .Site.Params.defaultDisclaimer }}</strong></p>
    {{ end }}

    {{ .Content }}

    {{ $shareURL := .Permalink | urlquery }}
    {{ $shareTitle := .Title }}
    {{ $lineText := printf "%s\n%s" $shareTitle .Permalink | urlquery }}
    <section class="share-buttons">
      <h2>この記事をシェアする</h2>
      <div class="share-buttons__links">
        <a class="share-button share-button--x" href="https://twitter.com/intent/tweet?url={{ $shareURL }}&text={{ $shareTitle | htmlEscape }}" target="_blank" rel="noopener" aria-label="Share on X">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M18 2h3l-6.5 7.4L22 22h-7l-4.5-6L5 22H2l7-8.1L2.5 2H9l4 5.5L18 2z" fill="currentColor"/></svg>
        </a>
        <a class="share-button share-button--line" href="https://line.me/R/msg/text/?{{ $lineText }}" target="_blank" rel="noopener" aria-label="Share on LINE">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M12 3c-5.5 0-10 3.6-10 8 0 2.7 1.9 5.1 4.8 6.5-.2.7-.8 2.8-.9 3.2-.1.4.2.3.4.2.2 0 2.8-1.8 3.9-2.5.6.1 1.3.1 1.8.1 5.5 0 10-3.6 10-8s-4.5-8-10-8z" fill="currentColor"/></svg>
        </a>
        <a class="share-button share-button--facebook" href="https://www.facebook.com/share.php?u={{ $shareURL }}" target="_blank" rel="noopener" aria-label="Share on Facebook">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M13 22v-8h3l1-4h-4V7c0-1.1.9-2 2-2h2V1h-3c-3 0-5 2.2-5 5v3H6v4h3v8h4z" fill="currentColor"/></svg>
        </a>
        <a class="share-button share-button--hatena" href="https://b.hatena.ne.jp/add?mode=confirm&url={{ $shareURL }}" target="_blank" rel="noopener" aria-label="Share on Hatena Bookmark">
          <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path d="M6 4h5.2c2.7 0 4.8 1.8 4.8 4 0 1.5-.9 2.6-2.2 3.2 1.8.5 3 1.9 3 3.8 0 2.5-2.2 4.5-5.1 4.5H6V4zm5 6c1.1 0 2-.7 2-1.8 0-1-1-1.7-2-1.7H9v3.5h2zm.4 6c1.3 0 2.3-.8 2.3-2s-1-2-2.3-2H9v4h2.4zM19 4h2v16h-2V4z" fill="currentColor"/></svg>
        </a>
      </div>
    </section>

    {{ $seriesPages := where (where .Site.RegularPages "Params.series" .Params.series) "Permalink" "ne" .Permalink }}
    {{ if gt (len $seriesPages) 0 }}
      <section class="related-posts">
        <h2>同シリーズの他の記事</h2>
        <ul>
          {{ range first 3 $seriesPages }}
            <li><a href="{{ .RelPermalink }}">{{ .Title }}</a>（{{ .Date.Format "2006-01-02" }}）</li>
          {{ end }}
        </ul>
      </section>
    {{ end }}

    {{ with .Params.affiliate_ids.others }}
      <section class="affiliate-list">
        <h2>デジタル配信／その他公式ストア</h2>
        <ul>
          {{ range . }}
            <li>
              <a href="{{ .url }}" target="_blank" rel="sponsored noopener">{{ .name }}</a>
            </li>
          {{ end }}
        </ul>
      </section>
    {{ end }}
  </article>
{{ end }}
